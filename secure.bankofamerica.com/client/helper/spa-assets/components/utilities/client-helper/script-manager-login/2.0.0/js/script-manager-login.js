var counter=0;var heartBeatIntervalMs=5000;var maxCheckAttempts=3;var heartBeatEventsCounter=0;var heartBeatStatus="";var heartBeatInterval=heartBeatIntervalMs;var errorList={"ERROR(701)":"true","ERROR(702)":"true","ERROR(703)":"true","ERROR(704)":"true","ERROR(705)":"true","ERROR(706)":"true"};var captureUrl="";var sendCsidContext=function(csidCookieValue){var context="";var waitTimeout=250;if($(".online-id-vipaa-module .enter-skin").is(":visible")){context="login-secure-signin"}else if($(".acw-widget-module .request-skin").is(":visible")||$(".xsw-widget-module .xtra-security-req-skin").is(":visible")){context="Request-OTAC-Authorization"}else if($(".acw-widget-module .enter-skin").is(":visible")){context="Enter-OTAC-Authorization"}if(typeof cdApi==="object"&&context!==""){cdApi.setCustomerSessionId(csidCookieValue);cdApi.changeContext(context);uiLoggerCall("Behbio vendb session -> csidCookieValue: "+csidCookieValue+" page_context: "+context);performFlush()}else{if(counter<=60){if(counter>40){waitTimeout=1000}let multipler=counter>40?counter-30:counter;uiLoggerCall("BehBio SDK is not loaded in "+multipler*waitTimeout+" miliseconds");window.setTimeout(function(){sendCsidContext(csidCookieValue)},waitTimeout);counter=counter+1}else{uiLoggerCall("BehBio SDK is not loaded due to web SDK error")}}};var scriptLoadFunctions=function(){var csidCookie="";document.cookie.split("; ").forEach(function(row){if(row.startsWith("CSID=")){csidCookie=row.split("CSID=")[1].split(":")[0]}});if(csidCookie){sendCsidContext(csidCookie)}else{uiLoggerCall("BehBio SDK is not loaded due to cookie")}};var callOptionB=function(){var scriptTagOptionB=document.createElement("script");var lleUrl=window.location.host.indexOf("helix.ecnp")>-1?true:false;var optionBAssetUrl="";if(lleUrl){optionBAssetUrl="https://uat-secure-"+window.location.host.split("-")[1]+"-helix.bac-assets.com/sparta/client/helper/spa-assets/components/utilities/client-helper/behbio/vendb-lle/3.0.0/js/vendb-lle.js"}else{optionBAssetUrl="https://secure.bankofamerica.com/client/helper/spa-assets/components/utilities/client-helper/behbio/vendb/3.0.0/js/vendb.js"}scriptTagOptionB.setAttribute("src",optionBAssetUrl);document.getElementsByTagName("head")[0].appendChild(scriptTagOptionB)};var uiLoggerCall=function(error){var uiLoggerLocation=window.location.host;var uiLoggerUrl="";if(uiLoggerLocation.indexOf("secure")>-1){uiLoggerUrl="https://"+uiLoggerLocation+"/login/rest/sas/sparta/ui/event/log"}else{var unsecureUrlLocation=uiLoggerLocation.replace("www","secure");uiLoggerUrl="https://"+unsecureUrlLocation+"/login/rest/sas/sparta/ui/event/log"}var request=new XMLHttpRequest;request.open("https://secure.bankofamerica.com/pa/components/modules-app/VIPAA/online-id-vipaa-module/1.0/script/POST",uiLoggerUrl,true);request.setRequestHeader("Content-type","application/json");request.setRequestHeader("accept","application/json");request.setRequestHeader("cache-control","no-cache");var params={application:window.location.href,errorType:navigator.userAgent,errorLog:error};request.send(JSON.stringify(params))};var startListen=function(){_setHeartBeatListener();setInterval(_checkHeartBeatStatus.bind(this),this.heartBeatInterval)};var _setHeartBeatListener=function(){window.addEventListener("message",event=>{if(event.data.type==="cdHeartbeat"){this.heartBeatEventsCounter+=1;this.heartBeatStatus=event.data.data}})};var _checkHeartBeatStatus=function(){var ahvcCookieHeartBeat="";document.cookie.split("; ").forEach(function(row){if(row.startsWith("AHVC=")){ahvcCookieHeartBeat=row}});var ahvcCookieHeartBeatValue=ahvcCookieHeartBeat.split("invokeHeartBeat:")[1];if(ahvcCookieHeartBeatValue==="true"){this.maxCheckAttempts-=1;if(this.maxCheckAttempts===0&&this.heartBeatEventsCounter===0){heartbeatapiCall("sdkBlocked")}if(this.heartBeatStatus==="Ok"){}else if(typeof this.heartBeatStatus==="object"){for(var errorCode in this.errorList){if(this.errorList[errorCode]==="true"){this.heartBeatStatus.forEach(function(code){if(code===errorCode){this.errorList[errorCode]="false";heartbeatapiCall()}})}}}}};var heartbeatapiCall=function(error){var captureApiLocation=window.location.host;var captureUrl="";if(captureApiLocation.indexOf("secure")>-1){captureUrl="https://"+captureApiLocation+"/login/rest/sas/sparta/v1/captureJsStatus"}else{var unsecureLocation=captureApiLocation.replace("www","secure");captureUrl="https://"+unsecureLocation+"/login/rest/sas/sparta/v1/captureJsStatus"}var requestPayload="";if(error==="sdkBlocked"){requestPayload={jsstatus:["ERROR(699)"]}}else{requestPayload={jsstatus:this.heartBeatStatus}}var request=new XMLHttpRequest;request.open("https://secure.bankofamerica.com/pa/components/modules-app/VIPAA/online-id-vipaa-module/1.0/script/POST",captureUrl,true);request.setRequestHeader("Content-type","application/json");request.setRequestHeader("accept","application/json");request.setRequestHeader("cache-control","no-cache");request.send(JSON.stringify(requestPayload))};var loadIac=function(){$.ajax({type:"GET",url:"/login/rest/sas/sparta/v2/iac?dfp=true",crossDomain:true,cache:false,timeout:60000,processData:false,xhrFields:{withCredentials:true},dataType:"text",headers:{"content-type":"application/json",accept:"application/json","cache-control":"no-cache"},error:function(XMLHTTPRequest,textStatus,errorThrown){triggerUiLogger("BehBio SDK is not loaded due to iacall")},success:function(data){scriptLoadFunctions()},complete:function(XMLHTTPRequest,textStatus){}})};callOptionB();var pageUrl=window.location.href;var otacPage=pageUrl.indexOf("/signOnSuccessRedirect.go")>-1;if(!otacPage){loadIac()}else{scriptLoadFunctions()}function flushdataevents(){var element_array=["signIn","passcode1","tlpvt-passcode-input","signin-with-mobile-app","signin-with-mobile-app-button","signin-pwdless","signin-pwdless-button","signin-pwdless-link","signin-with-mobile-app-link","signInWithMobileAppLink","signin-with-mobile-app-link-text","signin-with-passcode-text","signin-mobile-app","signin-with-passcode","signin-with-windows-hello","login_button","enterID-input"];for(var i=0;i<element_array.length;i++){var checkElement=document.getElementById(element_array[i]);if(checkElement){checkElement.addEventListener("mouseenter",function(){cdApi.client.flush()},{capture:true});checkElement.addEventListener("mousedown",function(){cdApi.client.flush()},{capture:true});checkElement.addEventListener("keydown",function(event){if(event.keyCode==13||event.keyCode==32){cdApi.client.flush()}},{capture:true});checkElement.addEventListener("touchstart",function(){cdApi.client.flush()},{capture:true})}}};function performFlush(){if(document.readyState==="complete"){flushdataevents()}else{document.addEventListener("readystatechange",function(){if(document.readyState==="complete"){flushdataevents()}})}}startListen();
//# sourceMappingURL=./script-manager-login.js.map